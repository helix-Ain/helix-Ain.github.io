<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> H5 DeviceMotionEvent开发手机摇一摇 · Helix</title><meta name="description" content="H5 DeviceMotionEvent开发手机摇一摇 - Ain"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Helix"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/helix-Ain" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="http://blog.csdn.net/ainsnow" target="_blank" class="nav-list-link">CSDN</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">H5 DeviceMotionEvent开发手机摇一摇</h1><div class="post-info">Aug 26, 2015</div><div class="post-content"><p>H5 DeviceMotionEvent开发手机摇一摇测试代码,代码未整理<br><a id="more"></a></p>
<p>事件devicemotion,其提供设备的加速信息，表示为定义在设备上的坐标系中的卡尔迪坐标。其还提供了设备在坐标系中的自转速率。<br><img src="https://sfault-image.b0.upaiyun.com/254/340/2543409338-547d2f8ca8e5d" alt="此处输入图片的描述"></p>
<p>DeviceMotionEvent 会在设备发生有意义的摆动(或运动)时产生.事件对象封装有产生的间距值,旋转率,和设备加速度.<br>加速度的计算方式是重力和用户产生的两个加速度矢量之和.设备是通过 陀螺仪和加速计来区别这两者的.<br>通过DeviceMotion对设备运动状态的判断，则可以帮助我们在网页上就实现“摇一摇”的交互效果。</p>
<p>测试Demo</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/1999/xhtml"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/public/jquery-mobile/themes/Ain.min.css"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/public/jquery-mobile/themes/jquery.mobile.icons.min.css"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"http://code.jquery.com/mobile/1.4.5/jquery.mobile.structure-1.4.5.min.css"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://code.jquery.com/jquery-1.11.1.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">data-role</span>=<span class="string">"page"</span> <span class="attr">style</span>=<span class="string">"background-color:#b7864c;"</span>&gt;</span></div><div class="line">			<span class="comment">&lt;!--&lt;div data-role="header" data-position="fixed"&gt;&lt;/div&gt;--&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">data-role</span>=<span class="string">"content"</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"text-align:center;"</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"box.jpg"</span> <span class="attr">style</span>=<span class="string">"width:150px;height:150px;border:0;"</span> /&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"start"</span>&gt;</span>开始计时<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"text-align:center;"</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">h1</span>&gt;</span>时间:&amp;nbsp;&amp;nbsp;<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"time"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"text-align:center"</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">h1</span>&gt;</span>成绩:&amp;nbsp;&amp;nbsp;<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"score"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"result"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">			<span class="comment">&lt;!--&lt;div data-role="footer" data-position="fixed"&gt;&lt;/div&gt;--&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line">			//设置阈值,防止用户的正常活动而触发</div><div class="line">			var SHAKE_THRESHOLD = 10;</div><div class="line">			var x = 0,</div><div class="line">				y = 0,</div><div class="line">				z = 0,</div><div class="line">				last_x = 0,</div><div class="line">				last_y = 0,</div><div class="line">				last_z = 0,</div><div class="line">				total = 0,</div><div class="line">				interval;</div><div class="line">			var temp = 0;</div><div class="line">			var time = 10;</div><div class="line">			var score = 0;</div><div class="line">			$(function() &#123;</div><div class="line">				if(window.DeviceMotionEvent) &#123;</div><div class="line">					//window.addEventListener('devicemotion', deviceMotionEventHandler, false);</div><div class="line">					window.console.log('浏览器支持DeviceMotionEvent');</div><div class="line">				&#125; else &#123;</div><div class="line">					alert('浏览器不支持DeviceMotionEvent');</div><div class="line">				&#125;</div><div class="line">				$('#time').html(time);</div><div class="line">				$('#score').html(score);</div><div class="line">				$('#start').bind('click', function() &#123;</div><div class="line">					$('#result').html('');</div><div class="line">					window.addEventListener('devicemotion', deviceMotionEventHandler, false);</div><div class="line">					$(this).html('正在计时..').attr('disabled', true);</div><div class="line">					interval = window.setInterval(function() &#123;</div><div class="line">						time--;</div><div class="line">						if(time == 0) &#123;</div><div class="line">							window.removeEventListener('devicemotion', deviceMotionEventHandler, false);</div><div class="line">							$('#time').html(time);</div><div class="line">							window.clearInterval(interval);</div><div class="line">							//$('#time').html('你的成绩为: ' + total);</div><div class="line">							$('#result').html('最终成绩:&amp;nbsp;&amp;nbsp;' + parseInt(total));</div><div class="line">							$('#score').text(parseInt(score));</div><div class="line">							$('#start').text('重新开始');</div><div class="line">							total = x = y = z = last_x = last_y = last_z = 0;</div><div class="line">							time = 10;</div><div class="line">							score = 0;</div><div class="line">							$('#start').removeAttr('disabled');</div><div class="line">						&#125; else &#123;</div><div class="line">							$('#time').html(time);</div><div class="line">							$('#score').html(parseInt(score));</div><div class="line">						&#125;</div><div class="line">					&#125;, 1000)</div><div class="line">				&#125;);</div><div class="line">			&#125;);</div><div class="line"></div><div class="line">			function deviceMotionEventHandler(event) &#123;</div><div class="line">				x = event.accelerationIncludingGravity.x;</div><div class="line">				y = event.accelerationIncludingGravity.y;</div><div class="line">				z = event.accelerationIncludingGravity.z;</div><div class="line">				temp = Math.abs(x - last_x) + Math.abs(y - last_y) + Math.abs(z - last_z);</div><div class="line">				if(temp &gt; SHAKE_THRESHOLD) &#123;</div><div class="line">					total = total + temp;</div><div class="line">					last_x = x;</div><div class="line">					last_y = y;</div><div class="line">					last_z = z;</div><div class="line">					score = total;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			//上传成绩</div><div class="line">			//    function uploadScore() &#123;</div><div class="line">			//        $.post('server.php', &#123; score: score &#125;, function (data) &#123;</div><div class="line"></div><div class="line">			//        &#125;);</div><div class="line">			//    &#125;</div><div class="line">			//    total += Math.abs(x - last_x) + Math.abs(y - last_y) + Math.abs(z - last_z);</div><div class="line">			//    last_x = x;</div><div class="line">			//    last_y = y;</div><div class="line">			//    last_z = z;</div><div class="line">			//&#125;</div><div class="line">			/*</div><div class="line">			 每摇一次把最新的成绩发送到后台还是只将最后的总成绩发送到后台</div><div class="line"></div><div class="line">			 思路:设计一张总页面通过ajax展示前几名的成绩最高者</div><div class="line"></div><div class="line">			 摇曳结束后页面重定位到颁奖页面</div><div class="line"></div><div class="line">			 摇曳过程中大屏幕时刻展示分数最后的几位用户</div><div class="line">			*/</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>参考资料:<a href="https://segmentfault.com/a/1190000003095883" target="_blank" rel="external">https://segmentfault.com/a/1190000003095883</a></p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/04/11/对easyui-combobox的简单封装/" class="prev">PREV</a><a href="/2015/07/22/PHP-Excel生成报表/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'seansun';
var disqus_identifier = '2015/08/26/H5-DeviceMotionEvent开发手机摇一摇/';
var disqus_title = 'H5 DeviceMotionEvent开发手机摇一摇';
var disqus_url = 'http://yoursite.com/2015/08/26/H5-DeviceMotionEvent开发手机摇一摇/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//seansun.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2016 <a href="http://yoursite.com">Ain</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>